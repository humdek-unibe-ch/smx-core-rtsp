/**
 * @file test_<box_name>.c
 *
 * THIS FILE WAS GENERATED BY THE STREAMIX TOOL `smxtrsp`. DO NOT EDIT THIS
 * FILE!
 *
 * ALL CHANGES MADE TO THIS FILE WILL BE OVERWRITTEN WHEN RECOMPILING THE
 * STREAMIX-SOURCE FILE!
 *
 * The test file which allows to test the box implementation.
 */

#ifndef APP_VERSION
#define APP_VERSION "unknown"
#endif

#include <unistd.h>
#include "smxrts.h"
#include "<box_name>.h"
#include "test_<box_name>.h"

#define LOG_APP_CONFIG_PATH "test.zlog"
#define JSON_APP_CONFIG_PATH "test.json"

int main( int argc, char **argv )
{
    int c;
    char* app_conf_file = NULL;
    char* log_conf_file = NULL;

    if( access( LOG_APP_CONFIG_PATH, F_OK ) != -1 )
        log_conf_file = LOG_APP_CONFIG_PATH;
    else
        fprintf( stderr, "warning: no default log config file found\n" );

    if( access( JSON_APP_CONFIG_PATH, F_OK ) != -1 )
        app_conf_file = JSON_APP_CONFIG_PATH;
    else
        fprintf( stderr, "warning: no default app config file found\n" );

    while( ( c = getopt( argc, argv, "hvc:l:" ) ) != -1 )
        switch( c ) {
            case 'h':
                printf( "Usage:\n  %s [OPTION...]\n\n", argv[0] );
                printf( "Options:\n" );
                printf( "  -h            This message.\n" );
                printf( "  -v            The version of the box implementation.\n" );
                printf( "  -c 'FILE'     Configuration file to be passed to the application.\n" );
                printf( "                If no file is specified the application falls back to:\n" );
                printf( "                 1. '%s' in the application root\n", JSON_APP_CONFIG_PATH );
                printf( "  -l 'FILE'     Log configuration file to be passed to the application.\n" );
                printf( "                If no file is specified the application falls back to:\n" );
                printf( "                 1. '%s' in the application root\n", LOG_APP_CONFIG_PATH );
                return 0;
            case 'v':
                printf( "<box_name> v%s\n", APP_VERSION );
                return 0;
            case 'c':
                app_conf_file = optarg;
                break;
            case 'l':
                log_conf_file = optarg;
                break;
            case '?':
                if( optopt == 'c' )
                    fprintf ( stderr, "Option -%c requires an argument.\n",
                            optopt );
                else
                    fprintf ( stderr, "Unknown option character `\\x%x'.\n",
                            optopt );
                return 1;
            default:
                abort();
        }

    smx_rts_t* rts = smx_program_init( app_conf_file, log_conf_file );

    SMX_NET_CREATE( 0, Test, <box_name>, 0 );
    SMX_NET_INIT( 0, <in_degree>, <out_degree>, <box_name> );
    //<net_ch_in>
    //<net_ch_out>
    SMX_PROGRAM_INIT_RUN();
    SMX_NET_RUN( 0, <box_name> );
    SMX_NET_WAIT_END( 0 );
    //<net_ch_rm_in>
    //<net_ch_rm_out>
    SMX_NET_DESTROY( 0 );

    smx_program_cleanup( rts );
}
